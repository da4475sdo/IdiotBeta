{"version":3,"sources":["game.js"],"names":["floorPositionArray","cc","Class","extends","Component","properties","areaWidth","floorGap","bottomFloorY","bottomFloorX","bottomFloor","default","type","Node","floorCount","score","otherFloor","Prefab","initFloor","player","counters","Label","resumeSign","backgroundAudioSource","url","AudioClip","onLoad","BGM","audioEngine","play","director","preloadScene","log","getPhysicsManager","enabled","manager","getCollisionManager","node","on","EventType","TOUCH_START","toggleGame","x","y","getComponent","game","createNewFloor","height","newFloor","instantiate","addChild","setSiblingIndex","setWidth","setPosition","tag","floorWidth","width","minX","maxX","floorX","floorY","Math","random","isPositionCError","index","floorArrayLength","length","preSecondIndex","preOneIndex","preIndexes","randomMinus1To1","getReversePosition","push","p","box","PhysicsBoxCollider","size","offset","v2","apply","setPositionSimple","setWidthSimple","update","dt","setScore","_score","string","toString","_director","_resumeSign","isPaused","resume","active","pause","module","exports","floorArray"],"mappings":"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","file":"game.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["var floorPositionArray=[];\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        areaWidth:960,\n        floorGap:200,\n        //最底下的floor的Y坐标\n        bottomFloorY:0,\n        //最底下的floor的X坐标\n        bottomFloorX:0,\n        //当前屏幕最底层的floor\n        bottomFloor:{\n            default: null,\n            type: cc.Node\n        },\n        //层数\n        floorCount:1,\n        //所得分数\n        score:0,\n        otherFloor: {\n            default: null,\n            type: cc.Prefab\n        },\n        initFloor: {\n            default: null,\n            type: cc.Node\n        },\n        player: {\n            default: null,\n            type: cc.Node\n        },\n        counters:{\n            default: null,\n            type: cc.Label\n        },\n        resumeSign:{\n            default: null,\n            type: cc.Node\n        },\n        //死亡音效 \n        backgroundAudioSource: {\n            url: cc.AudioClip,\n            default: null\n        },        \n    },\n\n    // use this for initialization\n    onLoad: function () {     \n        //播放背景音乐\n        var BGM = cc.audioEngine.play(this.backgroundAudioSource, true, 1);\n        //预加载游戏结束场景\n        cc.director.preloadScene(\"gameOver\", function () {\n            cc.log(\"gameOver scene preloaded\");\n        });\n        //开启物理系统\n        cc.director.getPhysicsManager().enabled = true;\n        //开启碰撞系统\n        var manager= cc.director.getCollisionManager();\n        manager.enabled=true;\n        //绑定屏幕点击事件\n        this.node.on(cc.Node.EventType.TOUCH_START,this.toggleGame,this);\n        //初始化当前最底层的floor坐标\n        this.bottomFloorX=this.initFloor.x;\n        this.bottomFloorY=this.initFloor.y;\n        this.player.getComponent(\"player\").game=this;\n        this.player.getComponent(\"player\").BGM=BGM;\n        this.createNewFloor();\n    },\n\n    createNewFloor:function (){\n        while(this.bottomFloorY>this.node.y-this.node.height){\n            var newFloor = cc.instantiate(this.otherFloor);\n            this.node.addChild(newFloor);\n            newFloor.setSiblingIndex(6);\n            newFloor.getComponent(\"floor\").game=this;\n            this.setWidth(newFloor);\n            newFloor.setPosition(this.setPosition(newFloor));\n            //手残党模式\n            // this.setWidthSimple(newFloor);\n            // newFloor.setPosition(this.setPositionSimple(newFloor));\n            this.bottomFloor=newFloor;\n            //设置新的floor的tag，用于之后计算得分\n            newFloor.tag=this.floorCount;\n            this.floorCount++;\n        }\n    },\n\n    setPosition:function (newFloor){\n        var floorWidth=newFloor.width,\n            minX=-(this.areaWidth/2)+floorWidth,\n            maxX=this.areaWidth/2-floorWidth-20,\n            floorX=0,\n            floorY=this.bottomFloorY-(Math.random()+1.5)*this.floorGap,\n            isPositionCError=true,\n            index=0,\n            floorArrayLength=floorPositionArray.length;\n        if(floorArrayLength>1){\n            var preSecondIndex=floorPositionArray[floorArrayLength-2],\n                preOneIndex=floorPositionArray[floorArrayLength-1],\n                preIndexes=preOneIndex+preSecondIndex;\n            switch(preIndexes){\n                case -3:preOneIndex<preSecondIndex?(cc.randomMinus1To1()>=0?index=0:index=1)\n                         :(cc.randomMinus1To1()>=0?index=1:index=2);break;\n                case -2:cc.randomMinus1To1()>=0?index=1:index=2;break;\n                case -1:if(preOneIndex===0||preSecondIndex===0){\n                            cc.randomMinus1To1()>=0?index=1:index=2;\n                        }else{\n                            index=this.getReversePosition(preOneIndex);\n                        }break;\n                case 0:index=this.getReversePosition(preOneIndex);break;\n                case 1:if(preOneIndex===0||preSecondIndex===0){\n                            cc.randomMinus1To1()>=0?index=-1:index=-2;\n                       }else{\n                           index=this.getReversePosition(preOneIndex);\n                       }break;\n                case 2:cc.randomMinus1To1()>=0?index=-1:index=-2;break;\n                case 3:preOneIndex>preSecondIndex?(cc.randomMinus1To1()>=0?index=0:index=-1)\n                        :(cc.randomMinus1To1()>=0?index=-1:index=-2);break;\n            };\n        }else{\n            if(floorArrayLength===0){\n                index=2;\n            }else{\n                cc.randomMinus1To1()>=0?index=-1:index=-2;\n            }\n        }\n        switch(index){\n            case -1:floorX=minX;break;\n            case -2:floorX=minX/2;break;\n            case 0:floorX=0;break;\n            case 1:floorX=maxX/2;break;\n            case 2:floorX=maxX;break;\n            default:floorX=0;break;\n        };\n        floorPositionArray.push(index);\n        this.bottomFloorX=floorX;\n        this.bottomFloorY=floorY;\n        return cc.p(floorX,floorY);\n    },\n\n    getReversePosition:function (preOneIndex){\n        var index=0;\n        preOneIndex>=0?(cc.randomMinus1To1()>=0?index=-1:index=-2)\n        :(cc.randomMinus1To1()>=0?index=1:index=2);\n        return index;\n    },\n\n    setWidth:function (newFloor){\n        //控制floor的随机宽度在initFloor宽度的1到1.5倍\n        var floorWidth=this.initFloor.width,\n            box=newFloor.getComponent(cc.PhysicsBoxCollider);\n        newFloor.width=floorWidth;\n        box.size=cc.size(floorWidth-17,1);\n        box.offset=cc.v2(2,1);\n        box.apply();\n    },\n\n    setPositionSimple:function (newFloor){\n        var floorWidth=newFloor.width, \n            floorX=0,\n            floorY=this.bottomFloorY-(Math.random()+1.5)*this.floorGap;\n        this.bottomFloorX>=0?floorX=-floorWidth/2:floorX=floorWidth/2;\n        this.bottomFloorX=floorX;\n        this.bottomFloorY=floorY;\n        return cc.p(floorX,floorY);\n    },\n\n    setWidthSimple:function (newFloor){\n        var floorWidth=this.node.width/2,\n            box=newFloor.getComponent(cc.PhysicsBoxCollider);\n        newFloor.width=floorWidth;\n        box.size=cc.size(floorWidth,1);\n        box.apply();\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    update: function (dt) {\n        this.bottomFloorY=this.bottomFloor.y;\n        this.createNewFloor();\n    },\n\n    setScore:function (_score){\n        this.score=_score;\n        this.counters.string=this.score.toString();\n    },\n\n    toggleGame:function (){\n        var _director=cc.director,\n            _resumeSign=this.resumeSign;\n        if(_director.isPaused()){\n            _director.resume();\n            _resumeSign.active=false;\n        }else{\n            _director.pause();\n            _resumeSign.active=true;\n        }\n    },\n});\n\n//通用变量\nmodule.exports = {\n    floorArray: floorPositionArray,\n};"]}